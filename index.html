<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stable Gravity Test</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    display: block;
    margin: 20px auto;
    border: 4px solid white;
    background: black;
  }
</style>
</head>

<body>
<h1>STABLE GRAVITY (SAFE)</h1>
<p>Yellow = star · Cyan = ship · Orange = asteroids</p>

<canvas id="game" width="512" height="512"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ================= HELPERS ================= */

function finite(n) {
  return Number.isFinite(n);
}

function wrap(o) {
  if (o.x < 0) o.x += 512;
  if (o.x > 512) o.x -= 512;
  if (o.y < 0) o.y += 512;
  if (o.y > 512) o.y -= 512;
}

/* ================= STATE ================= */

const star = { x:256, y:256 };

const ship = {
  x: 120,
  y: 120,
  vx: 1.2,
  vy: 0.8
};

const asteroids = [];
for (let i = 0; i < 4; i++) {
  asteroids.push({
    x: Math.random()*512,
    y: Math.random()*512,
    vx: (Math.random()-0.5)*1.2,
    vy: (Math.random()-0.5)*1.2,
    r: 18
  });
}

/* ================= SAFE GRAVITY ================= */

function gravity(o) {
  const dx = star.x - o.x;
  const dy = star.y - o.y;
  const d = Math.hypot(dx, dy);

  // HARD SAFETY LIMITS
  if (d < 40) return;
  if (d > 400) return;

  const force = 0.04;   // constant, gentle

  o.vx += (dx / d) * force;
  o.vy += (dy / d) * force;
}

/* ================= LOOP ================= */

function loop() {
  // RESET DRAW STATE
  ctx.setTransform(1,0,0,1,0,0);

  // BACKGROUND
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,512,512);

  // STATUS TEXT (always visible)
  ctx.fillStyle = "red";
  ctx.font = "16px monospace";
  ctx.fillText("RENDER + GRAVITY OK", 150, 20);

  /* ===== UPDATE ===== */

  gravity(ship);
  ship.x += ship.vx;
  ship.y += ship.vy;
  wrap(ship);

  for (const a of asteroids) {
    gravity(a);
    a.x += a.vx;
    a.y += a.vy;
    wrap(a);
  }

  // HARD SANITY CHECK
  if (
    !finite(ship.x) || !finite(ship.y) ||
    !finite(ship.vx) || !finite(ship.vy)
  ) {
    ctx.fillStyle = "yellow";
    ctx.fillText("GRAVITY ERROR DETECTED", 120, 260);
    return;
  }

  /* ===== DRAW ===== */

  // Star
  ctx.fillStyle = "yellow";
  ctx.beginPath();
  ctx.arc(star.x, star.y, 20, 0, Math.PI*2);
  ctx.fill();

  // Ship (big, simple, visible)
  ctx.fillStyle = "cyan";
  ctx.fillRect(ship.x - 10, ship.y - 10, 20, 20);

  // Asteroids
  ctx.strokeStyle = "orange";
  ctx.lineWidth = 4;
  for (const a of asteroids) {
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.r, 0, Math.PI*2);
    ctx.stroke();
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
