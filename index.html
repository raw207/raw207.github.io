<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- Disable cache for testing -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>Layer 2 – Ship + Bullets</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    display: block;
    margin: 20px auto;
    border: 4px solid white;
    background: black;
  }
</style>
</head>

<body>
<h1>Layer 2: Ship + Bullets</h1>
<p>Arrow keys move · Space fires</p>

<canvas id="game" width="512" height="512"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* INPUT */
const keys = {};
addEventListener("keydown", e => keys[e.key] = true);
addEventListener("keyup", e => keys[e.key] = false);

/* SHIP */
const ship = {
  x: 256,
  y: 256,
  speed: 3,
  cooldown: 0
};

/* BULLETS */
const bullets = [];

/* LOOP */
function loop() {

  /* ALWAYS DRAW FIRST */
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, 512, 512);

  /* DEBUG MARKER */
  ctx.fillStyle = "magenta";
  ctx.fillRect(4, 4, 8, 8);

  /* INPUT */
  if (keys["ArrowUp"]) ship.y -= ship.speed;
  if (keys["ArrowDown"]) ship.y += ship.speed;
  if (keys["ArrowLeft"]) ship.x -= ship.speed;
  if (keys["ArrowRight"]) ship.x += ship.speed;

  if (keys[" "] && ship.cooldown <= 0) {
    bullets.push({
      x: ship.x,
      y: ship.y,
      vy: -6,
      life: 60
    });
    ship.cooldown = 10;
  }
  ship.cooldown--;

  /* KEEP SHIP ON SCREEN */
  ship.x = Math.max(10, Math.min(502, ship.x));
  ship.y = Math.max(10, Math.min(502, ship.y));

  /* UPDATE BULLETS */
  for (let b of bullets) {
    b.y += b.vy;
    b.life--;
  }

  /* REMOVE DEAD BULLETS */
  for (let i = bullets.length - 1; i >= 0; i--) {
    if (bullets[i].life <= 0) bullets.splice(i, 1);
  }

  /* DRAW SHIP */
  ctx.fillStyle = "cyan";
  ctx.fillRect(ship.x - 10, ship.y - 10, 20, 20);

  /* DRAW BULLETS */
  ctx.fillStyle = "white";
  for (let b of bullets) {
    ctx.fillRect(b.x - 2, b.y - 6, 4, 8);
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
